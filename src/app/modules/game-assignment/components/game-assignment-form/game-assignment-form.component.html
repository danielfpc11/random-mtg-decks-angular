<main>
  <ng-container *ngIf="decks$ | async; let decks">
    <h1>{{ 'gameAssignment.form.createGame' | translate }}</h1>
    <form [formGroup]="playerForm" (ngSubmit)="addPlayer(getRandomDeck(decks))">
      <div id="name-form-control">
        <label id="name-label" for="name">
          {{ 'gameAssignment.form.playerName' | translate }}
        </label>
        <input id="name"
               type="text"
               formControlName="name"
               placeholder="{{ 'gameAssignment.form.playerNamePlaceholder' | translate }}">
      </div>
      <div class="action-buttons">
        <ng-container [ngTemplateOutlet]="actionButtons" [ngTemplateOutletContext]="{decks: decks}"></ng-container>
      </div>
    </form>
    <ng-container [ngTemplateOutlet]="formErrorMessages"></ng-container>
<!--    <game-assignment-player-list></game-assignment-player-list>-->
  </ng-container>
  <ng-container [ngTemplateOutlet]="saveGameButton"/>
</main>

<ng-template #formErrorMessages>
  <div *ngIf="getNameFormControl()?.invalid && (getNameFormControl()?.dirty || getNameFormControl()?.touched)"
        class="form-error-messages">
    <p *ngIf="getNameFormControl()?.errors?.['repeatedPlayerName']">
      * {{ 'gameAssignment.form.error.repeatedPlayerName' | translate }}
    </p>
    <p *ngIf="getNameFormControl()?.errors?.['playerLimitReached']">
      * {{ 'gameAssignment.form.error.playerLimitReached' | translate }}
    </p>
    <p *ngIf="getNameFormControl()?.errors?.['required']">
      * {{ 'gameAssignment.form.error.requiredPlayerName' | translate }}
    </p>
  </div>
</ng-template>

<ng-template #actionButtons let-decks='decks'>
  <button type="submit" class="action-button add-button">
    {{ 'gameAssignment.form.add' | translate }}
  </button>
  <button [disabled]="isPlayersEmpty"
          (click)="changePlayersDecks(decks)"
          class="action-button change-players-decks-button">
    {{ 'gameAssignment.form.changePlayersDecks' | translate }}
  </button>
</ng-template>

<ng-template #saveGameButton>
  <div class="save-game-button-container">
    <button [disabled]="!isEnoughPlayers" (click)="saveGame()" class="action-button save-game-button">
      {{ 'gameAssignment.form.saveGame' | translate }}
    </button>
  </div>
</ng-template>
